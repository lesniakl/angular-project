import{a as b}from"./chunk-GJZBLMNK.js";import{b as c,c as u,d as m,e as p,f as g,g as f}from"./chunk-BAEMG5CN.js";import{a as d,b as w,c as v,d as y,h as E}from"./chunk-SDUPZHXZ.js";import{g as i}from"./chunk-2R6CW7ES.js";function I(r){return r&&r.getDropdownItemElement!==void 0&&typeof r.getDropdownItemElement=="function"}var a=class{constructor(){this.dropdowns=new Map,this.submenuIds={},this.isWindowListenerActive=!1}connected(e){this.isWindowListenerActive||this.addOverlayListeners(),this.dropdowns.set(e.getId(),e),e.discoverAllSubmenus&&this.discoverSubmenus()}disconnected(e){this.dropdowns.delete(e.getId())}discoverSubmenus(){this.dropdowns.forEach(e=>{e.discoverSubmenu()})}present(e){!e.isPresent()&&e.willPresent()&&(this.submenuIds[e.getId()]=e.getAssignedSubmenuIds(),e.present())}dismissChildren(e){let t=this.submenuIds[e]||[];for(let s of t)this.dismiss(this.dropdowns.get(s))}dismiss(e){e.isPresent()&&e.willDismiss()&&(this.dismissChildren(e.getId()),e.dismiss(),delete this.submenuIds[e.getId()])}dismissAll(e=[],t=!1){this.dropdowns.forEach(s=>{let o=s.closeBehavior==="inside"||s.closeBehavior===!1,h=e.includes(s.getId()),S=this.buildComposedPath(s.getId(),new Set);if(e.length>0&&t){let l=!1;if(e.forEach(D=>{if(S.has(D)){l=!0;return}}),!l)return}!h&&o||this.dismiss(s)})}dismissOthers(e){let t=this.buildComposedPath(e,new Set);t.add(e),this.dropdowns.forEach(s=>{s.closeBehavior!=="inside"&&s.closeBehavior!==!1&&!t.has(s.getId())&&this.dismiss(s)})}pathIncludesTrigger(e){for(let t of e)if(t instanceof HTMLElement&&t.hasAttribute("data-ix-dropdown-trigger"))return t}pathIncludesDropdown(e){return!!e.find(t=>t.tagName==="IX-DROPDOWN")}buildComposedPath(e,t){this.submenuIds[e]&&t.add(e);for(let s of Object.keys(this.submenuIds))this.submenuIds[s].includes(e)&&this.buildComposedPath(s,t).forEach(o=>t.add(o));return t}addOverlayListeners(){this.isWindowListenerActive=!0,window.addEventListener("click",e=>{let t=this.pathIncludesTrigger(e.composedPath()),s=this.pathIncludesDropdown(e.composedPath());!t&&!s&&this.dismissAll()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.dismissAll([...this.dropdowns.keys()])})}},k=(r,e,t)=>(r.addEventListener(e,t),()=>{r.removeEventListener(e,t)}),n=new a,C=":host{background-color:var(--theme-color-2);border-radius:var(--theme-default-border-radius);min-width:0px;z-index:var(--theme-z-index-dropdown);box-shadow:var(--theme-shadow-4);padding:0.25rem 0px}:host *,:host *::after,:host *::before{box-sizing:border-box}:host ::-webkit-scrollbar-button{display:none}@-moz-document url-prefix(){:host *{scrollbar-color:var(--theme-scrollbar-thumb--background) var(--theme-scrollbar-track--background);scrollbar-width:thin}}:host ::-webkit-scrollbar{width:0.5rem;height:0.5rem}:host ::-webkit-scrollbar-track{border-radius:5px;background:var(--theme-scrollbar-track--background)}:host ::-webkit-scrollbar-track:hover{background:var(--theme-scrollbar-track--background--hover)}:host ::-webkit-scrollbar-thumb{border-radius:5px;background:var(--theme-scrollbar-thumb--background)}:host ::-webkit-scrollbar-thumb:hover{background:var(--theme-scrollbar-thumb--background--hover)}:host ::-webkit-scrollbar-corner{display:none}:host .dropdown-header{display:flex;align-items:center;height:2.5rem;color:var(--theme-menu-header--color);padding:0 1rem}:host(.overflow){max-height:50vh;overflow-y:auto}:host(:not(.show)){display:none}",x=C,P=0,O=(()=>{let r=class{constructor(e){E(this,e),this.showChanged=y(this,"showChanged",7),this.autoUpdateCleanup=null,this.localUId=`dropdown-${P++}`,this.assignedSubmenu=[],this.focusDropdownItemBind=this.focusDropdownItem.bind(this),this.itemObserver=new MutationObserver(()=>{this.arrowFocusController.items=this.dropdownItems}),this.suppressAutomaticPlacement=!1,this.show=!1,this.trigger=void 0,this.anchor=void 0,this.closeBehavior="both",this.placement="bottom-start",this.positioningStrategy="fixed",this.header=void 0,this.offset=void 0,this.overwriteDropdownStyle=void 0,this.discoverAllSubmenus=!1,this.ignoreRelatedSubmenu=!1}connectedCallback(){n.connected(this),this.trigger!=null&&this.registerListener(this.trigger)}cacheSubmenuId(e){e.stopImmediatePropagation(),e.preventDefault();let{detail:t}=e;this.assignedSubmenu.indexOf(t)===-1&&this.assignedSubmenu.push(t)}disconnectedCallback(){n.dismiss(this),n.disconnected(this),this.disposeClickListener&&this.disposeClickListener(),this.disposeKeyListener&&this.disposeKeyListener(),this.autoUpdateCleanup&&this.autoUpdateCleanup()}getAssignedSubmenuIds(){return this.assignedSubmenu}isPresent(){return this.show}present(){this.show=!0}dismiss(){this.show=!1}getId(){return this.localUId}willDismiss(){let{defaultPrevented:e}=this.showChanged.emit(!1);return!e}willPresent(){let{defaultPrevented:e}=this.showChanged.emit(!0);return!e}get dropdownItems(){return Array.from(this.hostElement.querySelectorAll("ix-dropdown-item"))}get slotElement(){return this.hostElement.shadowRoot.querySelector("slot")}addEventListenersFor(){var e,t,s;(e=this.disposeClickListener)===null||e===void 0||e.call(this),(t=this.disposeKeyListener)===null||t===void 0||t.call(this);let o=()=>{this.isPresent()?n.dismiss(this):n.present(this),n.dismissOthers(this.getId())};this.disposeClickListener=k(this.triggerElement,"click",h=>{h.defaultPrevented||o()}),(s=this.triggerElement)===null||s===void 0||s.setAttribute("data-ix-dropdown-trigger",this.localUId)}discoverSubmenu(){return i(this,null,function*(){var e;(e=this.triggerElement)===null||e===void 0||e.dispatchEvent(new CustomEvent("ix-assign-sub-menu",{bubbles:!0,composed:!0,cancelable:!0,detail:this.localUId}))})}registerKeyListener(){this.triggerElement&&(this.disposeKeyListener=k(this.triggerElement,"keydown",e=>{e.key==="ArrowDown"&&document.activeElement===this.triggerElement&&(n.present(this),setTimeout(()=>{this.focusDropdownItem(0)}))}))}registerListener(e){return i(this,null,function*(){this.triggerElement=yield this.resolveElement(e),this.triggerElement&&(this.addEventListenersFor(),this.discoverSubmenu())})}resolveElement(e){return i(this,null,function*(){let t=yield this.findElement(e);return this.checkForSubmenuAnchor(t)})}checkForSubmenuAnchor(e){return i(this,null,function*(){if(!e)return null;if(I(e)){let t=yield e.getDropdownItemElement();t.isSubMenu=!0,this.hostElement.style.zIndex="var(--theme-z-index-dropdown)"}return e.tagName==="IX-DROPDOWN-ITEM"&&(e.isSubMenu=!0,this.hostElement.style.zIndex="var(--theme-z-index-dropdown)"),e})}findElement(e){if(e instanceof Promise)return e;if(typeof e=="object")return Promise.resolve(e);if(typeof e!="string")return;let t=`#${e}`;return new Promise(s=>{if(document.querySelector(t))return s(document.querySelector(t));let o=new MutationObserver(()=>{document.querySelector(t)&&(s(document.querySelector(t)),o.disconnect())});o.observe(document.body,{childList:!0,subtree:!0})})}changedShow(e){return i(this,null,function*(){var t,s;e?(this.anchorElement=yield this.anchor?this.resolveElement(this.anchor):this.resolveElement(this.trigger),this.anchorElement&&this.applyDropdownPosition(),this.arrowFocusController=new b(this.dropdownItems,this.dropdownRef,this.focusDropdownItemBind),this.itemObserver.observe(this.dropdownRef,{childList:!0,subtree:!0}),this.registerKeyListener()):(this.destroyAutoUpdate(),(t=this.arrowFocusController)===null||t===void 0||t.disconnect(),this.itemObserver.disconnect(),(s=this.disposeKeyListener)===null||s===void 0||s.call(this))})}changedTrigger(e){this.registerListener(e)}destroyAutoUpdate(){this.autoUpdateCleanup&&(this.autoUpdateCleanup(),this.autoUpdateCleanup=null)}isAnchorSubmenu(){var e;return I(this.anchorElement)?!0:!!(!((e=this.anchorElement)===null||e===void 0)&&e.closest("ix-dropdown-item"))}applyDropdownPosition(){return i(this,null,function*(){if(!this.show||!this.anchorElement||!this.dropdownRef)return;let e=this.isAnchorSubmenu(),t={strategy:this.positioningStrategy,middleware:[]};this.suppressAutomaticPlacement||t.middleware.push(c({fallbackStrategy:"initialPlacement"})),t.placement=e?"right-start":this.placement,t.middleware=[...t.middleware,u(),p()],this.offset&&t.middleware.push(m(this.offset)),this.destroyAutoUpdate(),this.autoUpdateCleanup=g(this.anchorElement,this.dropdownRef,()=>i(this,null,function*(){let s=yield f(this.anchorElement,this.dropdownRef,t);if(Object.assign(this.dropdownRef.style,{top:"0",left:"0",transform:`translate(${Math.round(s.x)}px,${Math.round(s.y)}px)`}),this.overwriteDropdownStyle){let o=yield this.overwriteDropdownStyle({dropdownRef:this.dropdownRef,triggerRef:this.triggerElement});Object.assign(this.dropdownRef.style,o)}}),{ancestorResize:!0,ancestorScroll:!0,elementResize:!0})})}focusDropdownItem(e){requestAnimationFrame(()=>{var t;(t=this.dropdownItems[e])===null||t===void 0||t.shadowRoot.querySelector("button").focus()})}componentDidLoad(){return i(this,null,function*(){this.changedTrigger(this.trigger)})}componentDidRender(){return i(this,null,function*(){yield this.applyDropdownPosition(),this.anchorElement=yield this.anchor?this.resolveElement(this.anchor):this.resolveElement(this.trigger)})}isTriggerElement(e){return!!e.hasAttribute("data-ix-dropdown-trigger")}onDropdownClick(e){let t=n.pathIncludesTrigger(e.composedPath());if(t&&(t!==this.triggerElement&&e.preventDefault(),this.isTriggerElement(t))){this.closeBehavior==="outside"&&e.preventDefault();return}if(!e.defaultPrevented&&(this.closeBehavior==="inside"||this.closeBehavior==="both")){n.dismissAll([this.getId()],this.ignoreRelatedSubmenu);return}n.dismissOthers(this.getId())}updatePosition(){return i(this,null,function*(){this.applyDropdownPosition()})}render(){return d(w,{key:"1b165268d8ee5fa5f18bca276b0541da36bd3130","data-ix-dropdown":this.localUId,ref:e=>this.dropdownRef=e,class:{"dropdown-menu":!0,show:this.show,overflow:!0},style:{margin:"0",minWidth:"0px",position:this.positioningStrategy},role:"list",onClick:e=>this.onDropdownClick(e)},d("div",{key:"cdecec289e6c242a31b6160e93cb63b80bf5e535",style:{display:"contents"}},this.header&&d("div",{key:"27b86587be67c8086480ecec8059f8d6ae8aa5b7",class:"dropdown-header"},this.header),this.show&&d("slot",{key:"32d6960a187e91492e24fa7ee0d9407df1209829"})))}get hostElement(){return v(this)}static get watchers(){return{show:["changedShow"],trigger:["changedTrigger"]}}};return r.style=x,r})();export{O as ix_dropdown};
